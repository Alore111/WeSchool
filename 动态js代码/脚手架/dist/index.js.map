{"version":3,"file":"index.js","mappings":";;;;;;;;;;AAAA;;AAGA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AALA;AAOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;AACA;AAAA;;AAEA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AApBA;;AAuBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAFA;AAIA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAPA;AASA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAJA;AAMA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AAFA;;AAKA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAIA;AACA;;AAEA;AACA;AACA;AACA;AAEA;;AAEA;AACA;AACA;AAFA;;AAKA;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;;AAIA;AACA;;AAEA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AAJA;AAMA;;AAEA;;;;;AAKA;AAAA;;AACA;AACA;AACA;AACA;AACA;AACA;AAJA;AAMA;AACA;AACA;AACA;AADA;;AAIA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;;AAGA;AACA;;AAEA;AACA;AACA;AAFA;AAIA;AACA;;AAEA;;;AAGA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AAFA;;AAKA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AAJA;;AAOA;AACA;AAEA;AACA;;AAEA;;AAEA;AAAA;;AAGA;AACA;;;AAGA;AACA;AACA;AAFA;;AAKA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;;AAEA;;;AAGA;AACA;AAAA;AAAA;;AAIA;AACA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;AACA;AAEA;AACA;;AAEA;AACA;;;AAEA;AACA;AACA;AACA;AAAA;;AAAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AADA;;AAIA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AAFA;;AAKA;AACA;AACA;;;AAEA;AACA;AACA;AAAA;;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAJA;;AAOA;AACA;;;AAGA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AAFA;AAIA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;AACA;AACA;AACA;AAJA;AAMA;AA9hBA;AAkiBA;AACA","sources":["webpack://test/./dist/index.js"],"sourcesContent":["function runCode(){\n      \n  \n  var Page = function(page){\n    return page\n  }\nreturn Page({\n  \n  onLoad: function (options) {\n    options = this.options;\n    this.setdata({})\n  },\n  \n  parseTag(tag) {\n    let res = {\n        type1: \"tag\",\n        name: \"\",\n        voidElement: false,\n        // attrs: {},\n        children: [],\n    };\n    let tagMatch = tag.match(/<\\/?([^\\s]+?)[/\\s>]/);\n    if (tagMatch) {\n        // 标签名称为正则匹配的第2项\n        res.type1 = tagMatch[1];\n        if (tag.charAt(tag.length - 2) === \"/\") {\n            // 判断tag字符串倒数第二项是不是 / 设置为空标签。 例子：<img/>\n            res.voidElement = true;\n        }\n    }\n    // 匹配所有的标签正则\n    let classList = tag.match(/\\s([^'\"/\\s><]+?)\\s*?=\\s*?(\".*?\"|'.*?')/g);\n  \n    if (classList) {\n      let style = ''\n        for (let i = 0; i < classList.length; i++) {\n            // 去空格再以= 分隔字符串  得到['属性名称','属性值']\n   \n            let c = classList[i].split(\"=\");\n            // c[1] = c[1].replace(/\\s*/g, \"\")\n            c[0] = c[0].replace(/\\s*/g, \"\")\n            // 循环设置属性\n            var lengthc = 2\n            for(lengthc; lengthc < c.length ; lengthc++){\n              c[1] += \"=\" + c[lengthc]\n            }\n            let p = c[1].substring(1, c[1].length - 1)\n            try{\n              p = JSON.parse(c[1].substring(1, c[1].length - 1))\n            }catch(e){\n             \n            }\n  \n            if (c[1]) {\n              if(c[0] === ' style'){\n                style = p + style\n                res[c[0]] = style\n              }else{\n                res[c[0]] = p\n              }\n      \n            };\n  \n        }\n    }\n    return res;\n  },\n  \n  parse(html) {\n    var that = this;\n    let result = [];\n    let current;\n    let level = -1;\n    let arr = [];\n    let tagRE = /<[a-zA-Z\\-\\!\\/](?:\"[^\"]*\"['\"]*|'[^']*'['\"]*|[^'\">])*>/g;\n    html.replace(tagRE, function (tag, index) {\n        // 判断第二个字符是不是'/'来判断是否open\n        let isOpen = tag.charAt(1) !== \"/\";\n        // 获取标签末尾的索引\n        let start = index + tag.length;\n        // 标签之前的文本信息\n        let text = html.slice(start, html.indexOf(\"<\", start));\n  \n        let parent;\n        if (isOpen) {\n            level++;\n            // 设置标签属性\n            current = that.parseTag(tag);\n            // 判断是否为文本信息，是就push一个text children  不等于'  '\n            if (!current.voidElement && text.trim()) {\n                current[\"text\"] = text\n            }\n            // 如果我们是根用户，则推送新的基本节点\n            if (level === 0) {\n                result.push(current);\n            }\n            // 判断有没有上层，有就push当前标签\n            parent = arr[level - 1];\n            if (parent) {\n                parent.children.push(current);\n            }\n            // console.log(current)\n            arr[level] = current;\n        }\n        // 如果不是开标签，或者是空元素：</div><img>\n        if (!isOpen || current.voidElement) {\n            // level--\n            level--;\n        }\n    });\n    // console.log(result)\n    return result;\n  \n  },\nsetdata: function setdata(dictData) {\n  \n  for(var i in dictData){\n    this.data[i] = dictData[i]\n  }\n  var html = `<view  class=\"container\">  <view  class=\"home\" style=\"background-color: white; border-radius: 12rpx; margin-left: 2.6%; margin-top: 15rpx; width: 95%;\">  <view  class=\"home_title\" style=\"display: flex; height: 40px; margin-left: 15rpx; margin-top: 15rpx;\">  <view  class=\"title\" style=\"display: flex; height: 40px; margin-left: 15rpx; margin-top: 15rpx;\"> 首页按键  </view> <view  class=\"blank\" style=\"width: 50%;\">   </view> <view  class=\"manager\" bindtap=\"Manage\" style=\"${(typeof this.data.ismanage === \"object\" ? JSON.stringify( this.data.ismanage) : this.data.ismanage)}: ?; background-color: white; flex: auto; height: 20px; margin-right: 25rpx; margin-top: 15rpx; text-align: right;\"> ${(typeof this.data.manage_text === \"object\" ? JSON.stringify( this.data.manage_text) : this.data.manage_text)}  </view> ${(typeof this.data.ismanage === \"object\" ? JSON.stringify( this.data.ismanage) : this.data.ismanage) ? `<view  class=\"save\" bindtap=\"save\" style=\"display: flex; margin-right: 25rpx; margin-top: 15rpx;\"> 保存  </view> ` : ``} </view> <view  class=\"home_btn\">  <view  class=\"iconnBar_remove\" style=\"background-color: rgba(255, 255, 255, 0.7); border-radius: 20rpx; display: flex; flex-direction: row; flex-wrap: wrap; width: 710rpx;\">  <movable-area  class=\"moveArea\" style=\"background-color: rgba(255, 255, 255, 0.7); border-radius: 20rpx; display: flex; flex-direction: row; flex-wrap: wrap; height: ${(typeof this.data.itemWrapHeight === \"object\" ? JSON.stringify( this.data.itemWrapHeight) : this.data.itemWrapHeight)}px; margin-bottom: 15rpx; width: 710rpx;\">  ${(this.data.list).map((item, index) =>  `<movable-view  class=\"iconn\" wx:key=\"key\" id=\"${(typeof item.key === \"object\" ? JSON.stringify( item.key) : item.key)}\" x=\"${(typeof index === \"object\" ? JSON.stringify( index) : index)==(typeof this.data.cur === \"object\" ? JSON.stringify( this.data.cur) : this.data.cur)?(typeof this.data.tranX === \"object\" ? JSON.stringify( this.data.tranX) : this.data.tranX):(typeof item.tranX === \"object\" ? JSON.stringify( item.tranX) : item.tranX)}\" y=\"${(typeof index === \"object\" ? JSON.stringify( index) : index)==(typeof this.data.cur === \"object\" ? JSON.stringify( this.data.cur) : this.data.cur)?(typeof this.data.tranY === \"object\" ? JSON.stringify( this.data.tranY) : this.data.tranY):(typeof item.tranY === \"object\" ? JSON.stringify( item.tranY) : item.tranY)}\" direction=\"all\" disabled=\"${(typeof index === \"object\" ? JSON.stringify( index) : index)==(typeof this.data.cur === \"object\" ? JSON.stringify( this.data.cur) : this.data.cur)?(typeof this.data.disable === \"object\" ? JSON.stringify( this.data.disable) : this.data.disable):'true'}\" bind:longpress=\"longPress\" capture-catch:touchmove=\"touchMove\" catch:touchend=\"touchEnd\" friction=\"10000\" damping=\"1000\" style=\"height: calc(150rpx - 30rpx); padding-bottom: 10px; width: 20%;\">  <view  class=\"iconn_item\" id=\"${(typeof item.data.url === \"object\" ? JSON.stringify( item.data.url) : item.data.url)}\">  ${(typeof item.data.name === \"object\" ? JSON.stringify( item.data.name) : item.data.name)!=='更多' ? `<view >  <navigator  class=\"icon_item_url\" url=\"${(typeof this.data.ismanage === \"object\" ? JSON.stringify( this.data.ismanage) : this.data.ismanage)?'':(typeof item.data.url === \"object\" ? JSON.stringify( item.data.url) : item.data.url)}\" open-type=\"${(typeof item.data.type === \"object\" ? JSON.stringify( item.data.type) : item.data.type)==='tab跳转'?'switchTab':'navigate'}\" style=\"align-items: center; display: flex; flex-direction: column; justify-content: center; min-width: 120rpx;\">  <image  class=\"iconn_item_image\" src=\"${(typeof item.data.icon === \"object\" ? JSON.stringify( item.data.icon) : item.data.icon)}\" style=\"display: block; height: 80rpx; width: 80rpx;\">   </image> <text  style=\"color: #888; display: block; font-size: 26rpx; line-height: 30rpx; margin-top: 10rpx; text-align: center;\"> ${(typeof item.data.name === \"object\" ? JSON.stringify( item.data.name) : item.data.name)}  </text>  </navigator> <view  bindtap=\"remove_click\" id=\"${(typeof index === \"object\" ? JSON.stringify( index) : index)}\">  ${(typeof this.data.ismanage === \"object\" ? JSON.stringify( this.data.ismanage) : this.data.ismanage) ? `<image  class=\"jianjian\" src=\"../../../images/zan.png\" style=\"height: 35rpx; position: absolute; right: 5rpx; top: 0rpx; width: 35rpx;\">   </image> ` : ``} </view>  </view> ` : ``}<view  class=\"icon_item_url\" style=\"align-items: center; display: flex; flex-direction: column; justify-content: center; min-width: 120rpx;\"wx:else=\"\">  <image  class=\"iconn_item_image\" src=\"${(typeof item.icon === \"object\" ? JSON.stringify( item.icon) : item.icon)}\" style=\"display: block; height: 80rpx; width: 80rpx;\">   </image> <text  style=\"color: #888; display: block; font-size: 26rpx; line-height: 30rpx; margin-top: 10rpx; text-align: center;\"> ${(typeof item.name === \"object\" ? JSON.stringify( item.name) : item.name)}  </text>  </view>  </view>  </movable-view> `)} </movable-area>  </view>  </view>  </view> <view  class=\"other_btn\" style=\"background-color: white; border-radius: 12rpx; margin-left: 2.6%; margin-top: 25rpx; width: 95%;\">  <view  class=\"other_title\" style=\"margin-bottom: 15rpx; margin-left: 20rpx; padding-top: 15rpx;\"> 其余  </view> ${!(typeof this.data.other_iconList === \"object\" ? JSON.stringify( this.data.other_iconList) : this.data.other_iconList) ? `<view  class=\"other_message\" style=\"color: rgba(128, 128, 128, 0.507); margin-top: 100px; text-align: center;\"> 还没有多余的应用哦~~  </view> ` : ``}<view wx:else=\"\">  <view  class=\"iconn_add\" style=\"background-color: rgba(255, 255, 255, 0.7); border-radius: 20rpx; display: flex; flex-direction: row; flex-wrap: wrap; margin-bottom: 15px; width: 710rpx;\">  ${(this.data.other_iconList).map((item, index) =>  `<view  class=\"icon\" wx:key=\"key\" direction=\"all\" bindtap=\"${(typeof this.data.ismanage === \"object\" ? JSON.stringify( this.data.ismanage) : this.data.ismanage)?(typeof this.data.add_click === \"object\" ? JSON.stringify( this.data.add_click) : this.data.add_click):''}\" style=\"align-items: center; display: flex; flex-direction: column; height: calc(150rpx - 30rpx); justify-content: center; padding: 17rpx 0 10rpx 0; position: relative; width: 20%;\">  <view  class=\"icon_item\" id=\"${(typeof item.url === \"object\" ? JSON.stringify( item.url) : item.url)}\">  <navigator  class=\"icon_item_url\" url=\"${(typeof this.data.ismanage === \"object\" ? JSON.stringify( this.data.ismanage) : this.data.ismanage)?'':(typeof item.url === \"object\" ? JSON.stringify( item.url) : item.url)}\" open-type=\"${(typeof item.type === \"object\" ? JSON.stringify( item.type) : item.type)==='tab跳转'?'switchTab':'navigate'}\" style=\"align-items: center; display: flex; flex-direction: column; justify-content: center; min-width: 120rpx;\">  <image  class=\"icon_item_image\" src=\"${(typeof item.icon === \"object\" ? JSON.stringify( item.icon) : item.icon)}\" style=\"display: block; height: 80rpx; width: 80rpx;\">   </image> <text  style=\"color: #888; display: block; font-size: 26rpx; line-height: 30rpx; margin-top: 10rpx; text-align: center;\"> ${(typeof item.name === \"object\" ? JSON.stringify( item.name) : item.name)}  </text>  </navigator> ${(typeof this.data.ismanage === \"object\" ? JSON.stringify( this.data.ismanage) : this.data.ismanage) ? `<view  bindtap=\"add_click\" id=\"${(typeof index === \"object\" ? JSON.stringify( index) : index)}\">  ${(typeof this.data.ismanage === \"object\" ? JSON.stringify( this.data.ismanage) : this.data.ismanage) ? `<image  class=\"jiajia\" src=\"../../../images/zan1.png\" style=\"height: 35rpx; position: absolute; right: 8rpx; top: 5rpx; width: 35rpx;\">   </image> ` : ``} </view> ` : ``} </view>  </view> `)} </view>  </view>  </view> <view  class=\"trail\" style=\"color: rgba(128, 128, 128, 0.603); margin-top: 40rpx; text-align: center;\"> 长按可排序  </view> <view  class=\"trail\" style=\"color: rgba(128, 128, 128, 0.603); margin-top: 40rpx; text-align: center;\"> We校园~~  </view>  </view> `\n  this.setData({html : this.parse(html)});\n},\n  \n    data: {\n        ismanage: false, //判别状态\n        manage_text: \"管理\",\n\n        before_IconList: [], //点击取消，还原之前的首页按钮数组\n        before_other_iconList: [], //点击取消，还原之前的其余按钮数组\n        iconList: [], //首页按钮\n        other_iconList: [], //其余按钮\n        inform: [],\n\n        //移动排序数据\n        disable: true, //判断是否移动\n        list: [],\n        //移动\n        itemTransition: false,\n        //列数、行数\n        columns: 5,\n        rows: 0,\n        //按钮框高度、宽度\n        itemWrapHeight: 0,\n        //itemWrapWidth: 0,\n    },\n\n    //界面初始，读取首页按钮缓存、其余按钮缓存\n    onShow: function (options) {\n        //从缓存中或取iconList\n        var that = this\n        var other_btn = wx.getStorageSync('other_btn')\n        that.setdata({\n            other_iconList: other_btn.other_iconList,\n            iconList: other_btn.iconList\n        })\n        this.init(); //按钮排序坐标初始化\n    },\n\n    //管理按钮，turn时触发移除、增加按钮；false时禁用\n    Manage: function () {\n        let init_other_iconList = JSON.parse(JSON.stringify(this.data.other_iconList))\n        let init_iconList = JSON.parse(JSON.stringify(this.data.list))\n\n        if (this.data.ismanage) {\n            this.setdata({\n                ismanage: false,\n                manage_text: \"管理\",\n                list: this.data._iconList,\n                // iconList: this.data.before_IconList,\n                other_iconList: this.data._other_iconList\n                // iconList:init_iconList,\n                // other_iconList:init_other_iconList\n            })\n            this.getWidth_Height()\n            //刷新按钮排序也可以用这个函数\n            this.getAfterRemove_Btn_Position(this.data.list);\n        } else {\n            this.setdata({\n                ismanage: true,\n                manage_text: \"取消\",\n                _iconList: init_iconList,\n                _other_iconList: init_other_iconList\n            })\n        }\n    },\n\n    //需求将obj这个对象拷贝出一个新对象修改新对象的值不会影响原对象的值\n    //定义一个函数\n\n    //移除按钮，把首页按键移除到其余按键\n    remove_click: function (e) {\n        var id = e.currentTarget.id\n        var arr = JSON.parse(JSON.stringify(this.data.list)) //上图标\n        var other_arr = JSON.parse(JSON.stringify(this.data.other_iconList)) //下图标\n        // console.log(arr,other_arr);\n\n        other_arr.push(arr[id].data)\n        arr.splice(id, 1)\n        // console.log(arr);\n\n        let list = this.getAfterRemove_Btn_Position(arr)\n\n        //console.log(list)\n\n        this.setdata({\n            other_iconList: other_arr,\n            list: list\n        })\n\n        this.getWidth_Height();\n    },\n\n    //增加按钮,把其余按键添加到首页按键\n    add_click: function (e) {\n        var id = e.currentTarget.id\n        var arr = JSON.parse(JSON.stringify(this.data.list))\n        var other_arr = JSON.parse(JSON.stringify(this.data.other_iconList))\n\n        let data = this.getAdd_Btn_Position(other_arr[id]);\n\n\n\n        arr.push(data)\n        other_arr.splice(id, 1)\n\n        arr.forEach((e, index) => {\n            if (e.data.name === '更多') {\n                arr[index] = arr.splice(arr.length - 1, 1, arr[index])[0];\n            }\n\n        })\n\n        this.setdata({\n            other_iconList: other_arr,\n            list: arr\n        })\n\n        this.getWidth_Height(); //根据按键数，更改按钮框体大小\n\n    },\n\n    //保存排序，回到初始状态\n    save: function () {\n        var that = this\n\n        //将list里面的data提取出来，赋值到iconList保存到手机内存上\n        let iconList = []\n        let list = that.data.list.forEach(item => {\n            //iconList.push(item.data)\n            //因为移动会打乱数据排序，为了保存打乱的数据排序，要用item.key\n            iconList[item.key] = item.data\n        })\n        //避免深存储无法更改数据\n        this.setdata({\n            iconList: iconList\n        })\n\n        var arr = JSON.parse(JSON.stringify(this.data.iconList)) //上图标\n        var other_arr = JSON.parse(JSON.stringify(this.data.other_iconList)) //下图标\n\n        //console.log(that.data.iconList)\n        let bb = {\n            other_iconList: that.data.other_iconList,\n            iconList: iconList,\n        }\n        wx.setStorageSync('other_btn', bb)\n        //回到初始状态\n        that.setdata({\n            ismanage: false,\n            manage_text: \"管理\",\n            _iconList: arr,\n            _other_iconList: other_arr\n        })\n    },\n\n    /**\n     *移动排序代码\n     *实现思路：\n     *一、初始化init()， \n     **/\n    init: function () {\n        let list = this.data.iconList.map((item, index) => {\n            let data = {\n                key: index,\n                tranX: 0,\n                tranY: 0,\n                data: item\n            }\n            return data\n        });\n        this.setdata({\n            list: list,\n        });\n\n        // 获取每一项的宽高等属性\n        this.createSelectorQuery().select(\".iconn\").boundingClientRect((res) => {\n\n            let rows = Math.ceil(this.data.list.length / this.data.columns); //获取行数\n\n            this.item = res;\n\n            this.getPosition(this.data.list, false);\n\n            let itemWrapHeight = rows * res.height;\n\n            //console.log(\"行数、按钮高度、按钮框体高度\", rows, res.height, itemWrapHeight);\n\n            \n            //let itemWrapWidth = this.data.columns * res.width;\n            //console.log(\"按钮框体高度、宽度\", itemWrapHeight, itemWrapWidth);\n\n            this.setdata({\n                itemWrapHeight: itemWrapHeight,\n                //itemWrapWidth: itemWrapWidth\n            });\n        }).exec();\n    },\n\n    /**\n     * 长按触发移动排序\n     */\n    longPress(e) {\n        //console.log(1111)\n        //长按直接触发管理事件manage\n        if (!this.data.ismanage) this.Manage();\n\n        let list = []\n\n        this.data.list.forEach((item) => {\n            list[item.key] = item\n        })\n\n        this.setdata({\n            list:list,\n            disable: false\n        });\n\n        //console.log(e)\n\n        this.startX = e.changedTouches[0].pageX\n        this.startY = e.changedTouches[0].pageY\n\n        let index = e.currentTarget.id;\n        //console.log(index)\n        //console.log(\"key\",this.data.list[index].key)\n\n        //console.log(\"long\",index)\n        if (this.data.columns === 1) { // 单列时候X轴初始不做位移\n            this.tranX = 0;\n        } else { // 多列的时候计算X轴初始位移, 使 item 水平中心移动到点击处\n            this.tranX = this.startX - this.item.width / 2 - 8;\n        }\n\n            // 计算Y轴初始位移, 使 item 垂直中心移动到点击处\n        this.tranY = this.startY - this.item.height / 2 - 40;\n\n        //console.log(\"计算后X/Y坐标\",this.tranX, this.tranY);\n\n        this.setdata({\n            cur: index,\n            //curZ: index,\n            tranX: this.tranX,\n            tranY: this.tranY,\n        });\n\n        wx.vibrateShort();\n    },\n    \n    touchMove(e) {\n        if (this.data.disable) return; //如果不可动，直接返回\n\n        //console.log(e)\n\n        let tranX = e.touches[0].pageX - this.startX + this.tranX,\n            tranY = e.touches[0].pageY - this.startY + this.tranY;\n\n        // let tranX = e.detail.x,\n        //     tranY = e.detail.y;\n        \n\n        this.setdata({\n            tranX: tranX,\n            tranY: tranY\n        });\n\n        //console.log(e);\n        //触发拖到事件时，setdata无法更改e.currentTarget.id，只能读取数组中的key\n        //否则会触发if (originKey == endKey || this.originKey == originKey) return;，结果无反应\n        let originKey = this.data.list[e.currentTarget.id].key;\n\n        //console.log(\"点击的index\", originKey)\n        let endKey = this.calculateMoving(tranX, tranY);\n        //console.log(e)\n        //console.log(\"id\",this.originKey,originKey,endKey)\n        //console.log(\"移动到的位置\", endKey)\n        // 防止拖拽过程中发生乱序问题\n        if (originKey == endKey || this.originKey == originKey) return;\n\n        this.originKey = originKey;\n\n        this.insert(originKey, endKey);\n    },\n\n    /**\n     * 根据当前的手指偏移量计算目标key\n     */\n    calculateMoving(tranX, tranY) {\n        let rows = Math.ceil(this.data.list.length / this.data.columns) - 1,\n            i = Math.round(tranX / this.item.width),\n            j = Math.round(tranY / this.item.height);\n\n        i = i > (this.data.columns - 1) ? (this.data.columns - 1) : i;\n        i = i < 0 ? 0 : i;\n\n        j = j < 0 ? 0 : j;\n        j = j > rows ? rows : j;\n\n        let endKey = i + this.data.columns * j;\n\n        endKey = endKey >= this.data.list.length ? this.data.list.length - 1 : endKey;\n\n        return endKey\n    },\n\n    touchEnd() {\n        if (this.data.disable) return;\n\n        this.clearData();\n    },\n\n    // /**\n    //  * 根据排序后 list 数据进行位移计算\n    //  */\n    getPosition(data, vibrate = true) {\n        let list = data.map((item, index) => {\n            item.tranX = this.item.width * (item.key % this.data.columns);\n            item.tranY = Math.floor(item.key / this.data.columns) * this.item.height;\n            // console.log(item.key)\n            //console.log(\"每个按钮的坐标\", item.tranX, item.tranY);\n            return item\n        });\n\n        this.setdata({\n            list: list\n        });\n\n        //console.log(\"list\",this.data.list)\n\n        if (!vibrate) return;\n\n        wx.vibrateShort();\n\n        //let listData = []\n        let iconListData = []\n\n        list.forEach((item) => {\n            //console.log(\"item\",item)\n            //listData[item.key] = item\n            iconListData[item.key] = item.data\n        });\n\n        this.setdata({\n            //list: listData,\n            iconList: iconListData\n        })\n    \n        //this.triggerEvent('change', {list: listData});\n     //console.log(\"list\",this.data.list)\n    },\n\n    //去除一个按键，重新计算其余按键排序\n    //刷新按钮坐标排序也可以用这个函数\n    getAfterRemove_Btn_Position(data) {\n        let list = data.map((item, index) => {\n            item.key = index\n            item.tranX = this.item.width * (item.key % this.data.columns);\n            item.tranY = Math.floor(item.key / this.data.columns) * this.item.height;\n            return item\n        });\n\n        return list\n    },\n\n    //增加一个按键，需计算其的位置x、y，直接调用init造成渲染重复\n    getAdd_Btn_Position(data) {\n        console.log(this.data.list.length)\n        let list = {\n            data: data,\n            key: this.data.list.length,\n            tranX: this.item.width * (this.data.list.length % this.data.columns),\n            tranY: Math.floor(this.data.list.length / this.data.columns) * this.item.height\n        };\n\n        return list\n    },\n\n\n    //根据按键数，更改按钮框体大小\n    getWidth_Height: function () {\n        let rows = Math.ceil(this.data.list.length / this.data.columns); //获取行数\n\n        let itemWrapHeight = rows * this.item.height;\n\n        let itemWrapWidth = this.data.columns * this.item.width;\n\n        this.setdata({\n            itemWrapHeight: itemWrapHeight,\n            itemWrapWidth: itemWrapWidth\n        });\n    },\n\n    insert: function (origin, end) {\n        let list\n        if (origin < end) {\n            list = this.data.list.map((item) => {\n                //console.log(\"item\",item)\n                if (item.key > origin && item.key <= end) {\n                    item.key = item.key - 1;\n                } else if (item.key == origin) {\n                    item.key = end;\n                }\n                return item\n            });\n            this.getPosition(list);\n        } else if (origin > end) {\n            list = this.data.list.map((item) => {\n                if (item.key >= end && item.key < origin) {\n                    item.key = item.key + 1;\n                } else if (item.key == origin) {\n                    item.key = end;\n                }\n                return item\n            });\n            this.getPosition(list);\n        }\n    },\n    /**\n     * 清除参数\n     */\n    clearData() {\n        this.originKey = -1;\n\n        this.setdata({\n            disable: true,\n            cur: -1,\n            tranX: 0,\n            tranY: 0\n        });\n    }\n})\n\n\n}\n  window.exports = runCode;\n\n  "],"names":[],"sourceRoot":""}