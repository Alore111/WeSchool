{"version":3,"file":"index.js","mappings":";;;;;;;;;;;;AAAA;AAAA;;AAEA;;AAIA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AALA;AAOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;AACA;AAAA;;AAEA;AACA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAGA;AAAA;AAAA;AAAA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA1BA;AA4BA;AAAA;;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAFA;AAIA;;AAEA;;AAEA;AACA;AACA;AAFA;AAIA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AARA;AAUA;AACA;AACA;;;;;;AAMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AAGA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;AACA;AACA;AACA;AALA;;AAQA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AALA;AAWA;AACA;AACA;AACA;AACA;AACA;AA9CA;AAgDA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AADA;;AAIA;AACA;AACA;AACA;AAEA;AADA;;AAQA;AACA;AACA;AAFA;AAIA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAFA;AAIA;AAEA;AACA;AAGA;AACA;AACA;AACA;AACA;AAHA;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAEA;AACA;AACA;AADA;AAGA;AACA;AACA;AACA;AATA;;AACA;AAAA;AASA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;AACA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAHA;AAKA;AAAA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAXA;AAaA;AACA;AACA;AACA;AADA;AAKA;AACA;AACA;AACA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;AAGA;AACA;AACA;AACA;AACA;AAHA;;AAMA;AACA;AACA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;;AAKA;AAEA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;;AAKA;AAEA;AACA;AAEA;AAlfA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAmfA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AADA;AAGA;AACA;AACA;AACA;AACA;AACA;AAJA;AAMA;;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAFA;AAIA;AACA;;AACA;AACA;AACA;AACA;AADA;AAGA;;AACA;AACA;AACA;AACA;AADA;AAGA;;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AAGA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAHA;AAFA;AAQA;;AAEA;AAFA;AAIA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AAJA;AAMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AANA;AAFA;AAWA;AACA;AACA;AACA;AACA;AACA;AALA;AAOA;AACA;AACA;AACA;AACA;AACA;AAhCA;AAkCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AANA;AAQA;;AACA;AACA;AACA;AACA;AACA;AADA;AAGA;;AACA;AACA;AACA;AACA;AADA;AAGA;AACA;AACA;AACA;AADA;AAGA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAZA;AAcA;AACA;AACA;AACA;AAFA;AAKA;AACA;AACA;;;AAGA;;;AAGA;;AAIA;;;AAGA;;AA5tBA;AAuvBA;AACA","sources":["webpack://test/./dist/index.js"],"sourcesContent":["function runCode(){\n    \r\nconst db = wx.cloud.database({env:'mall-7gi19fir46652cb4'})\r\n\r\n  \n  \n  var Page = function(page){\n    return page\n  }\nreturn Page({\n  \n  parseTag(tag) {\n    let res = {\n        type1: \"tag\",\n        name: \"\",\n        voidElement: false,\n        // attrs: {},\n        children: [],\n    };\n    let tagMatch = tag.match(/<\\/?([^\\s]+?)[/\\s>]/);\n    if (tagMatch) {\n        // 标签名称为正则匹配的第2项\n        res.type1 = tagMatch[1];\n        if (tag.charAt(tag.length - 2) === \"/\") {\n            // 判断tag字符串倒数第二项是不是 / 设置为空标签。 例子：<img/>\n            res.voidElement = true;\n        }\n    }\n    // 匹配所有的标签正则\n    let classList = tag.match(/\\s([^'\"/\\s><]+?)\\s*?=\\s*?(\".*?\"|'.*?')/g);\n  \n    if (classList) {\n      let style = ''\n        for (let i = 0; i < classList.length; i++) {\n            // 去空格再以= 分隔字符串  得到['属性名称','属性值']\n   \n            let c = classList[i].split(\"=\");\n            // c[1] = c[1].replace(/\\s*/g, \"\")\n            c[0] = c[0].replace(/\\s*/g, \"\")\n            // 循环设置属性\n            var lengthc = 2\n            for(lengthc; lengthc < c.length ; lengthc++){\n              c[1] += \"=\" + c[lengthc]\n            }\n            let p = c[1].substring(1, c[1].length - 1)\n            try{\n              p = JSON.parse(c[1].substring(1, c[1].length - 1))\n            }catch(e){\n             \n            }\n  \n            if (c[1]) {\n              if(c[0] === ' style'){\n                style = p + style\n                res[c[0]] = style\n              }else{\n                res[c[0]] = p\n              }\n      \n            };\n  \n        }\n    }\n    return res;\n  },\n  \n  parse(html) {\n    var that = this;\n    let result = [];\n    let current;\n    let level = -1;\n    let arr = [];\n    let tagRE = /<[a-zA-Z\\-\\!\\/](?:\"[^\"]*\"['\"]*|'[^']*'['\"]*|[^'\">])*>/g;\n    html.replace(tagRE, function (tag, index) {\n        // 判断第二个字符是不是'/'来判断是否open\n        let isOpen = tag.charAt(1) !== \"/\";\n        // 获取标签末尾的索引\n        let start = index + tag.length;\n        // 标签之前的文本信息\n        let text = html.slice(start, html.indexOf(\"<\", start));\n  \n        let parent;\n        if (isOpen) {\n            level++;\n            // 设置标签属性\n            current = that.parseTag(tag);\n            // 判断是否为文本信息，是就push一个text children  不等于'  '\n            if (!current.voidElement && text.trim()) {\n                current[\"text\"] = text\n            }\n            // 如果我们是根用户，则推送新的基本节点\n            if (level === 0) {\n                result.push(current);\n            }\n            // 判断有没有上层，有就push当前标签\n            parent = arr[level - 1];\n            if (parent) {\n                parent.children.push(current);\n            }\n            // console.log(current)\n            arr[level] = current;\n        }\n        // 如果不是开标签，或者是空元素：</div><img>\n        if (!isOpen || current.voidElement) {\n            // level--\n            level--;\n        }\n    });\n    // console.log(result)\n    return result;\n  \n  },\nsetdata: function setdata(dictData) {\n  \n  for(var i in dictData){\n    this.data[i] = dictData[i]\n  }\n  var html = `${(typeof this.data.tabbar === \"object\" ? JSON.stringify( this.data.tabbar) : this.data.tabbar) ? `<view >  ${!(typeof this.data.shopyesno === \"object\" ? JSON.stringify( this.data.shopyesno) : this.data.shopyesno) ? `<view  class=\"bg-red flex justify-center\">  <view  class=\"action\">  ${!(typeof this.data.weihu === \"object\" ? JSON.stringify( this.data.weihu) : this.data.weihu) ? `<text > 【${(typeof this.data.shopname === \"object\" ? JSON.stringify( this.data.shopname) : this.data.shopname)}】目前已打样  </text> ` : ``}${(typeof this.data.weihu === \"object\" ? JSON.stringify( this.data.weihu) : this.data.weihu) ? `<text > 聚食集平台23:50-00:00定期维护  </text> ` : ``} </view>  </view> ` : ``}<scroll-view  scroll-y=\"true\" style=\"height:100vh;display: flex;\" scroll-into-view=\"main-${(typeof this.data.MainCur === \"object\" ? JSON.stringify( this.data.MainCur) : this.data.MainCur)}\" bindscroll=\"VerticalMain\">  ${(this.data.goods).map((item, index) =>  `<view  wx:key=\"id\">  <view  class=\"goods\" style=\"align-items: center; display: flex; height: 235rpx; margin: 0 40rpx 65rpx 40rpx; width: 100%;\">  <view  class=\"goodsImg\" style=\"align-items: center; background-color: #cdb5d3; border-radius: 15rpx; display: flex; height: 100%; justify-content: center; width: 240rpx;\">  <image  src=\"${(typeof item.img === \"object\" ? JSON.stringify( item.img) : item.img)}\" mode=\"aspectFill\" style=\"height: 94%; width: 94%;\">   </image>  </view> <view  class=\"goodsContent\" style=\"height: 100%; line-height: 52rpx; padding: 0 0 0 19rpx; width: 58%;\">  <view  class=\"goodsName\" style=\"-webkit-box-orient: vertical; -webkit-line-clamp: 2; display: -webkit-box; font-size: 30rpx; font-weight: 550; overflow: hidden; text-overflow: ellipsis; width: 100%; word-break: break-all;\"> ${(typeof item.name === \"object\" ? JSON.stringify( item.name) : item.name)}  </view> <view  class=\"goodsBrief\" style=\"color: rgba(58, 58, 58, 0.904); font-size: 26rpx; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; width: 100%;\"> 开胃韩式泡菜 + 五常大米 + 肥牛  </view> <view  class=\"goodsSold\" style=\"color: rgba(78, 78, 78, 0.692); font-size: 24rpx; width: 100%;\"> 月售 ${(typeof item.yuenumber === \"object\" ? JSON.stringify( item.yuenumber) : item.yuenumber)}  </view> <view  class=\"goodsPrice\" style=\"color: #8984A8; font-family: inherit; font-size: 33rpx; position: relative; top: 27rpx;\"> \r\n            ￥ <text  class=\"price\" style=\"font-size: 43rpx; font-weight: 455; position: relative; right: 10rpx;\"> ${(typeof item.price === \"object\" ? JSON.stringify( item.price) : item.price)}  </text>  </view> <view  class=\"goodsAdd\" id=\"${(typeof index === \"object\" ? JSON.stringify( index) : index)}\" bindtap=\"oneaddgoods\" style=\"align-items: center; background-color: #8584A3; border-radius: 50rpx; bottom: 28rpx; display: flex; float: right; height: 45rpx; justify-content: center; position: relative; width: 45rpx;\">  <image  src=\"data:image/png;base64,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\" style=\"height: 58%; width: 58%;\">   </image>  </view>  </view>  </view>  </view> `)} </scroll-view>  </view> ` : ``}${!((typeof this.data.tabbar === \"object\" ? JSON.stringify( this.data.tabbar) : this.data.tabbar)) ? `<view >  <view  class=\"hhh bg-gradual-green flex justify-center\" style=\"undefined;${this.data.dark === 'dark' ? '    filter: invert(100%) !important;  ' : ''}\">  <view  class=\"action\">  <text  class=\"cuIcon-title text-red\">   </text> <text > 平台联系方式：18403441128  </text>  </view>  </view> <view  class=\"  solid-bottom\">  <view  class=\"action\" style=\"display: inline;\">  <view  class=\"flex\">  <text  class=\"cuIcon-location text-green\">   </text>  </view> ${!((typeof this.data.havelocation === \"object\" ? JSON.stringify( this.data.havelocation) : this.data.havelocation)) ? `<view  style=\"padding-left:30rpx\" bindtap=\"userlocation\">  <text  style=\"color:blue\"> 点击设置地址  </text>  </view> ` : ``}<view  style=\"padding-left:30rpx;font-size: 26rpx;\" bindtap=\"userlocation\"wx:else=\"\">  <text  class=\"text-bold\"> ${(typeof this.data.userlocation.school === \"object\" ? JSON.stringify( this.data.userlocation.school) : this.data.userlocation.school)}-${(typeof this.data.userlocation.location === \"object\" ? JSON.stringify( this.data.userlocation.location) : this.data.userlocation.location)}-${(typeof this.data.userlocation.sushehao === \"object\" ? JSON.stringify( this.data.userlocation.sushehao) : this.data.userlocation.sushehao)}-${(typeof this.data.userlocation.name === \"object\" ? JSON.stringify( this.data.userlocation.name) : this.data.userlocation.name)}-${(typeof this.data.userlocation.tell === \"object\" ? JSON.stringify( this.data.userlocation.tell) : this.data.userlocation.tell)}  </text>  </view>  </view>  </view> <view  class=\"cu-bar solid-bottom\">  <view  class=\"action flex justify-between\">  <view >  <text  style=\"margin-left: -180%;;${this.data.dark === 'dark' ? '    filter: invert(100%) !important;  ' : ''}\" class=\"cuIcon-form text-green hhh\"> 全部订单  </text>  </view>  </view> <view  style=\"padding-right:30rpx\">  <text  class=\"cuIcon-unfold lg\" style=\"font-size: 2em; height: 175rpx; width: 175rpx;\">   </text>  </view>  </view> <view  class=\"cu-card case\">  ${(this.data.mydingdan).map((item, index) =>  `<view  wx:key=\"_id\">  <view  class=\"cu-item shadow\" style=\"background-color: #fff; margin: 10rpx;\">  <view  class=\"cu-list menu-avatar\">  <view  class=\"flex radius text-bold solids-bottommy justify-between\" style=\"border-bottom: 1rpx solid #eee; padding: 20rpx 0 20rpx 30rpx;\">  <view > ${(typeof item.shopname === \"object\" ? JSON.stringify( item.shopname) : item.shopname)} <text  style=\"font-size:20rpx\"> (下单时间${(typeof item.upday === \"object\" ? JSON.stringify( item.upday) : item.upday)}-${(typeof item.uptime === \"object\" ? JSON.stringify( item.uptime) : item.uptime)})  </text>  </view> <view  class=\"hhh\" style=\"undefined;${this.data.dark === 'dark' ? '    filter: invert(100%) !important;  ' : ''}\">  ${(typeof item.go === \"object\" ? JSON.stringify( item.go) : item.go)==0 ? `<view  class=\"text-yellow \" style=\"padding-right:20rpx\"> 待出单  </view> ` : ``}${(typeof item.go === \"object\" ? JSON.stringify( item.go) : item.go)>0 ? `<view  class=\"text-green \" style=\"padding-right:20rpx\"> 已出单  </view> ` : ``} </view>  </view> <view  style=\"padding: 10rpx 0;\">  <scroll-view  class=\"bg-white nav\" style=\"margin: 0 20rpx;${this.data.dark === 'dark' ? '    background-color: #000;  ' : ''}\">  ${(this.data.item.buy).map((dingdanbuy, index) =>  `<view  class=\"hhh\" wx:key=\"id\" wx:for-item=\"dingdanbuy\" style=\"undefined;${this.data.dark === 'dark' ? '    filter: invert(100%) !important;  ' : ''}\">  <view  class=\"dingdanimg cu-list grid\" style=\"display: inline-block; height: 90rpx; margin: 0 10rpx;\">  <image  class=\"cu-avatar xl\" src=\"${(typeof dingdanbuy.img === \"object\" ? JSON.stringify( dingdanbuy.img) : dingdanbuy.img)}\" style=\"display: flex; font-size: 2em; height: 175rpx; width: 175rpx;;${this.data.dark === 'dark' ? '    filter: invert(100%) !important;  ' : ''}\">  ${(typeof dingdanbuy.number === \"object\" ? JSON.stringify( dingdanbuy.number) : dingdanbuy.number)>1 ? `<view  class=\"cu-tag badge\" style=\"top: 0rpx;right: 0rpx;\"> \r\n                      ${(typeof dingdanbuy.number === \"object\" ? JSON.stringify( dingdanbuy.number) : dingdanbuy.number)}\r\n                      </view> ` : ``} </image> <view  class=\"flex\" style=\"width:128rpx\">  <text  class=\"text-cut\"> ${(typeof dingdanbuy.name === \"object\" ? JSON.stringify( dingdanbuy.name) : dingdanbuy.name)}  </text>  </view>  </view>  </view> `)} </scroll-view> <view  class=\"flex solids-topmy justify-start\" style=\"border-bottom: 1rpx solid #eee;\">  <view  style=\"padding:10rpx 20rpx 10rpx 20rpx\">  <text  style=\"color:grey;font-size:25rpx\"> 备注: ${(typeof item.beizu === \"object\" ? JSON.stringify( item.beizu) : item.beizu) ? `<block > ${(typeof item.beizu === \"object\" ? JSON.stringify( item.beizu) : item.beizu)}  </block> ` : ``}<block wx:else=\"\"> 无  </block>  </text>  </view>  </view> <view  class=\"flex solids-topmy justify-start\" style=\"border-bottom: 1rpx solid #eee;\">  <view  style=\"padding:0rpx 20rpx\">  <text  style=\"color:grey;font-size:25rpx\"> ${(typeof item.school === \"object\" ? JSON.stringify( item.school) : item.school)}-${(typeof item.location === \"object\" ? JSON.stringify( item.location) : item.location)}-${(typeof item.sushehao === \"object\" ? JSON.stringify( item.sushehao) : item.sushehao)}-${(typeof item.name === \"object\" ? JSON.stringify( item.name) : item.name)}-${(typeof item.tell === \"object\" ? JSON.stringify( item.tell) : item.tell)}  </text>  </view>  </view> <view  class=\"flex solids-topmy justify-start\" style=\"border-bottom: 1rpx solid #eee;\">  <view  style=\"padding:0rpx 20rpx\">  ${(typeof item.school === \"object\" ? JSON.stringify( item.school) : item.school)=='师范 ( 目前东门自取 ) ' ? `<text  style=\"color:grey;font-size:25rpx\"> 师范:周一到周五中午东门自取,周五下午到周日送到宿舍！  </text> ` : ``} </view>  </view> <view  class=\"flex solids-topmy justify-start\" style=\"border-bottom: 1rpx solid #eee;\">  <view  style=\"padding:0rpx 20rpx\">  <text  style=\"color:grey;font-size:25rpx\"> 订单号：${(typeof item.outTradeNo === \"object\" ? JSON.stringify( item.outTradeNo) : item.outTradeNo)}  </text>  </view>  </view> <view  class=\"flex solids-topmy justify-between\" style=\"border-bottom: 1rpx solid #eee;\">  <view  style=\"padding:10rpx 20rpx 10rpx 20rpx\">  <text  style=\"font-size:35rpx\"> ${(typeof item.yuyue === \"object\" ? JSON.stringify( item.yuyue) : item.yuyue)}  </text>  </view> <view  style=\"padding:10rpx 20rpx 10rpx 0\">  <text  style=\"color:grey;font-size:25rpx\"> 共${(typeof item.totalnumber === \"object\" ? JSON.stringify( item.totalnumber) : item.totalnumber)}件  </text> <text  style=\"color:red;font-size:35rpx\"> ￥${(typeof item.totalprice === \"object\" ? JSON.stringify( item.totalprice) : item.totalprice)}  </text>  </view>  </view>  </view>  </view>  </view>  </view> `)} </view>  </view> ` : ``}<view  class=\"flex\" style=\"padding:50rpx\">   </view> <view  class=\"box\" style=\"width:100%;position:fixed;bottom:0;z-index:9999\">  <view  class=\"settle\" bindtap=\"showModal\" style=\"background-color: rgb(255, 255, 255); height: 90rpx; width: 100%;\">  <view  class=\"settleAll\" style=\"display: flex; flex-direction: row; float: right; font-size: 30rpx; height: 100%; width: 50%;\">  <view  class=\"calcAll\" style=\"color: rgb(0, 0, 0); font-size: 28rpx; height: 100%; line-height: 43rpx; width: 60%;\"> \r\n          合计： <text  style=\"color: #7C73A9; font-size: 30rpx; position: relative; right: 10rpx;\"> ￥${(typeof this.data.totalprice === \"object\" ? JSON.stringify( this.data.totalprice) : this.data.totalprice)==0?'0.00':(typeof this.data.totalprice === \"object\" ? JSON.stringify( this.data.totalprice) : this.data.totalprice)}  </text> <view  class=\"freight\" style=\"color: rgba(78, 78, 78, 0.692); float: right; font-size: 25rpx; margin-right: 35rpx;\"> 不含运费  </view>  </view> <view  class=\"goSettle\" bindtap=\"pay\" style=\"align-items: center; background-color: #696BA4; color: rgb(255, 255, 255); display: flex; font-size: 26rpx; height: 100%; justify-content: center; width: 50%;\"> 结算  </view>  </view>  </view> <view  class=\"cu-bar bg-white tabbar border shop\" style=\"font-size:35rpx; height: 130rpx;;${this.data.dark === 'dark' ? '    background-color: #000;  ' : ''}\">  <view  bindtap=\"tabbarshop\" class1=\"bg-green submit ${(typeof this.data.tabbar === \"object\" ? JSON.stringify( this.data.tabbar) : this.data.tabbar)?'bg-green':'    background-color: #000;  '}\">  <text  class=\"cuIcon-shopfill\">  商铺  </text>  </view> <view  bindtap=\"tabbaruser\" class1=\"bg-green submit ${(typeof this.data.tabbar === \"object\" ? JSON.stringify( this.data.tabbar) : this.data.tabbar)?'    background-color: #000;  ':'bg-green'}\">  <text  class=\"cuIcon-my\"> 我的  </text>  </view>  </view> <view  class=\"body\">  ${(this.data.data_show).map((item, index) =>  `<view  class=\"body-describe\">  <text  class=\"body-describe-text\"> ${(typeof item.name === \"object\" ? JSON.stringify( item.name) : item.name)}:  </text> <view  class=\"body-describe-data\"> ${(typeof item.res === \"object\" ? JSON.stringify( item.res) : item.res)}  </view>  </view> `)} </view> <view  class=\"end\">  <view  class=\"end-text\" bindtap=\"Check\"> 查看公式  </view>  </view>  </view> ${(typeof this.data.modalName === \"object\" ? JSON.stringify( this.data.modalName) : this.data.modalName) ? `<view  class=\"EditCom\" style=\"align-items: center; bottom: 0; display: flex; font-family: unset; justify-content: center; left: 0; position: fixed; right: 0; top: 0; z-index: 9999;\">  <view  class=\"EditCom_background\" bindtap=\"showModal\" style=\"align-items: center; background-color: rgba(0, 0, 0, 0.92); bottom: 0; display: flex; font-family: unset; height: 100%; justify-content: center; left: 0; opacity: 0.6; position: fixed; right: 0; top: 0; z-index: 9999;\">   </view> <view  class=\"EditCom_contain \" style=\"background-color: rgb(244, 244, 244); border-radius: 20rpx; bottom: 0; display: flex; flex-direction: column; justify-content: center; overflow: hidden; padding: 20rpx; position: fixed; width: 100%; z-index: 99999;;EditCom_contain ${(typeof this.data.payStyle === \"object\" ? JSON.stringify( this.data.payStyle) : this.data.payStyle)}\">  ${(this.data.buy).map((item, index) =>  `<view >  <view  class=\"buy\" style=\"display: flex; height: 150rpx; padding-bottom: 20rpx; width: 100%;\">  <view  class=\"buyImg\" style=\"height: 130rpx; width: 130rpx;\">  <image  src=\"${(typeof item.img === \"object\" ? JSON.stringify( item.img) : item.img)}\" mode=\"aspectFill\" style=\"height: 100%; width: 100%;\">   </image>  </view> <view  class=\"buyContent\" style=\"display: flex; flex-direction: column; line-height: 65rpx; padding: 0 15rpx; width: 80%;\">  <view  class=\"buyName\" style=\"font-size: 30rpx; font-weight: 550; width: 100%;\"> ${(typeof item.name === \"object\" ? JSON.stringify( item.name) : item.name)}  </view> <view >  <view  class=\"buyPrice\" style=\"color: #8984A8; font-size: 38rpx; font-weight: 550;\"> ￥${(typeof item.price === \"object\" ? JSON.stringify( item.price) : item.price)}  </view> <view  class=\"buyNumber\" style=\"align-items: center; bottom: 60rpx; display: flex; float: right; height: 50rpx; justify-content: center; position: relative; width: 182rpx;\">  <view  class=\"numberDel\" bindtap=\"reducenumber\" id=\"${(typeof index === \"object\" ? JSON.stringify( index) : index)}\" style=\"align-items: center; background-color: rgba(179, 179, 179, 0.14); border-bottom-left-radius: 8rpx; border-top-left-radius: 8rpx; display: flex; height: 100%; justify-content: center; margin: 0 7rpx; width: 62rpx;\"> -  </view> <view  class=\"numberShow\" style=\"align-items: center; background-color: rgba(179, 179, 179, 0.14); display: flex; font-size: 24rpx; height: 100%; justify-content: center; width: 70rpx;\"> ${(typeof item.number === \"object\" ? JSON.stringify( item.number) : item.number)}  </view> <view  class=\"numberAdd\" bindtap=\"addgoods\" id=\"${(typeof index === \"object\" ? JSON.stringify( index) : index)}\" style=\"align-items: center; background-color: rgba(179, 179, 179, 0.14); border-bottom-right-radius: 8rpx; border-top-right-radius: 8rpx; display: flex; height: 100%; justify-content: center; margin: 0 7rpx; width: 62rpx;\"> +  </view>  </view>  </view>  </view>  </view>  </view> `)} </view>  </view> ` : ``}`\n  this.setData({html : this.parse(html)});\n},\n  \r\n  data: {\r\n    weihu: false,\r\n    guige: false,\r\n    goodsguigekouwei: [],\r\n    goodsguigekouwei2: [],\r\n    goods: [],\r\n    guigeindex: '0',\r\n    guigeindex2: '0',\r\n    shopyesno: true,\r\n    mydingdan: [], //订单\r\n    mydindantotal: 0,\r\n    skip: 0, //订单跳过前几条\r\n    newuser: true,\r\n    /* --------------------- */\r\n    buy: [], //购物车\r\n    totalprice: 0,\r\n    totalnumber: 0,\r\n    /* ---------------------- */\r\n    tabbar: true,\r\n    havelocation: false,\r\n    /* --------------------- */\r\n    TabCur: '0',\r\n    MainCur: 0,\r\n    VerticalNavTop: 0,\r\n    list: [],\r\n    load: true,\r\n    data_show:[]\r\n  },\r\n  onLoad: function (option)  {options = this.options; this.data.dark =wx.getSystemInfoSync().theme; wx.onThemeChange(e => {console.log(e.theme);this.setdata({dark: e.theme})}); this.setdata();\r\n    console.log(option)\r\n    var shop_id = 'uncanny'\r\n    wx.showLoading({\r\n      title: '加载中...',\r\n      mask: true\r\n    });\r\n    var self = this\r\n\r\n    db.collection('shop').doc(shop_id).get().then(res => {\r\n \r\n      wx.setStorage({\r\n        key: \"shop\",\r\n        data: res.data\r\n      })\r\n      console.log(\"goods\", res.data.goods);\r\n      \r\n      self.setdata({\r\n        shop_id: shop_id,\r\n        caidan: res.data.caidan,\r\n        goods: res.data.goods,\r\n        goprice: res.data.goprice * 1,\r\n        shopyesno: res.data.shopyesno,\r\n        shopyesnoing: res.data.shopyesno,\r\n        shopname: res.data.name,\r\n        shopid: res.data.shopid,\r\n      })\r\n{\r\n        console.log(123)\r\n        /* if (nowtime >= \"23:50\" && nowtime <= \"23:59\") {\r\n          self.setdata({\r\n            weihu: true,\r\n            shopyesno: false,\r\n          })\r\n        } */\r\n        // 调用云函数获取用户openid\r\n        wx.cloud.callFunction({\r\n          name: 'login',\r\n          env:'mall-7gi19fir46652cb4',\r\n          data: {},\r\n          success: loginres => {\r\n            console.log('[云函数] [login] user openid: ', loginres.result.openid)\r\n            app.globalData.openid = loginres.result.openid\r\n            db.collection('userinfo').where({\r\n              _openid: loginres.result.openid\r\n            }).get().then(userinfores => {\r\n              if (userinfores.data.length > 0) {\r\n                wx.setStorage({\r\n                  key: \"userinfo\",\r\n                  data: userinfores.data[0]\r\n                })\r\n                self.setdata({\r\n                  newuser: false,\r\n                  username: userinfores.data[0].username,\r\n                  usertximg: userinfores.data[0].usertximg,\r\n                  userlocation: userinfores.data[0].userlocation,\r\n                  havelocation: userinfores.data[0].havelocation\r\n                })\r\n                \r\n                  self.onShow()\r\n                  console.log(res.data.caidan, 1233)\r\n                  self.caidanxuanran(res.data.caidan)\r\n                \r\n              } else {\r\n                let args = wx.getStorageSync('args')\r\n                db.collection('userinfo').add( {\r\n                  data: {\r\n                  _openid:loginres.result.openid,\r\n                  username: args.username,\r\n                  havelocation: false,\r\n                  userlocation: {},\r\n                  usertximg: args.iconUrl\r\n\r\n                }}).then(\r\n                  self.onShow()\r\n                )\r\n   \r\n              }\r\n            })\r\n          },\r\n          fail: err => {\r\n            console.error('[云函数] [login] 调用失败', err)\r\n          }\r\n        })\r\n      }\r\n      console.log(res.data)\r\n    })\r\n\r\n  },\r\n  onShow(e) {\r\n    var self = this\r\n    var skip = self.data.skip\r\n    var userinfo =wx.getStorageSync('userinfo')\r\n    this.setdata({userlocation: userinfo.userlocation})\r\n    \r\n    if(!self.data.newuser){\r\n      db.collection('dindan').where({\r\n        _openid: app.globalData.openid\r\n      }).count().then(totalres => {\r\n   \r\n        if (totalres.total > 20) {\r\n          skip = totalres.total - 20\r\n        }\r\n        db.collection('dindan')\r\n          .where({\r\n            _openid: app.globalData.openid\r\n          })\r\n          .skip(skip)\r\n          .limit(20)\r\n          .get()\r\n          .then(res => {\r\n     \r\n            self.setdata({\r\n              mydindantotal: totalres.total,\r\n              mydingdan: res.data.reverse()\r\n            })\r\n            wx.hideNavigationBarLoading()\r\n            wx.stopPullDownRefresh()\r\n            console.log(res.data)\r\n          })\r\n          .catch(err => {\r\n            wx.hideNavigationBarLoading()\r\n            wx.stopPullDownRefresh()\r\n            console.error(err)\r\n          })\r\n      })\r\n    }\r\n    \r\n    console.log(this.data.mydingdan, '55')\r\n    wx.hideHomeButton();\r\n  },\r\n  /* 菜单渲染 */\r\n  caidanxuanran(e) {\r\n    var caidan = e\r\n    let list = [{}];\r\n    for (let i = 0; i < caidan.length; i++) {\r\n      list[i] = {};\r\n      list[i].name = caidan[i].name;\r\n      list[i].id = i;\r\n      list[i].myid = caidan[i].myid;\r\n    }\r\n    console.log(list, 233)\r\n    this.setdata({\r\n      list: list,\r\n      listCur: list[0]\r\n    })\r\n      wx.hideLoading()\r\n    \r\n  },\r\n  onReady() {\r\n\r\n  },\r\n  tabSelect(e) {\r\n    this.setdata({\r\n      TabCur: String(e.currentTarget.dataset.id),\r\n      MainCur: e.currentTarget.dataset.id,\r\n      VerticalNavTop: (e.currentTarget.dataset.id - 1) * 50\r\n    })\r\n  },\r\n  VerticalMain(e) {\r\n    let that = this;\r\n    let list = this.data.list;\r\n    console.log(\"list\",list);\r\n    let tabHeight = 0;\r\n    if (this.data.load) {\r\n      for (let i = 0; i < list.length; i++) {\r\n        let view = wx.createSelectorQuery().select(\"#main-\" + list[i].id);\r\n        view.fields({\r\n          size: true\r\n        }, data => {\r\n          list[i].top = tabHeight;\r\n          tabHeight = tabHeight + data.height;\r\n          list[i].bottom = tabHeight;\r\n        }).exec();\r\n      }\r\n      that.setdata({\r\n        load: false,\r\n        list: list\r\n      })\r\n    }\r\n    let scrollTop = e.detail.scrollTop + 20;\r\n    for (let i = 0; i < list.length; i++) {\r\n      if (scrollTop > list[i].top && scrollTop < list[i].bottom) {\r\n        that.setdata({\r\n          VerticalNavTop: (list[i].id - 1) * 50,\r\n          TabCur: String(list[i].id)\r\n        })\r\n        return false\r\n      }\r\n    }\r\n  },\r\n  /* 第一次添加购物车 */\r\n  oneaddgoods(e) {\r\n    var self = this\r\n    var newuser = self.data.newuser\r\n   console.log(\"newuser\",newuser);\r\n   console.log(\"e\",e);\r\n    if (newuser) {\r\n      wx.showToast({\r\n        title: '成功',\r\n        icon: 'success',\r\n        duration: 1000\r\n      })\r\n    } else {\r\n\r\n      var index = e.currentTarget.id\r\n      console.log(\"self.data.goods\",self.data.goods);\r\n      var goodsnumber = self.data.goods[index].number\r\n      var goodsdata = \"goodt[\" + index + \"].number\"\r\n      var buy = this.data.buy\r\n      var goods = {\r\n        guige: false,\r\n        id: self.data.goods[index].id,\r\n        img: self.data.goods[index].img,\r\n        name: self.data.goods[index].name,\r\n        price: self.data.goods[index].price,\r\n        zhekou: self.data.goods[index].zhekou,\r\n        nowprice: self.data.goods[index].nowprice,\r\n        shangpu: self.data.goods[index].shangpu, //所属商铺\r\n        shopid: self.data.goods[index].shopid,\r\n        number: 1, //用户购物车数量\r\n        index: index, //在goods列表里的index\r\n      }\r\n      buy.push(goods)\r\n      self.data.goods[index].number += 1\r\n      self.setdata({\r\n        buy: buy,\r\n        [goodsdata]: goodsnumber + 1,\r\n        goods: self.data.goods\r\n      })\r\n      console.log(goodsnumber + 1)\r\n      self.buy(buy)\r\n    }\r\n  },\r\n  /* 购物车+1 */\r\n  addgoods(e) {\r\n    var self = this\r\n    var index = e.currentTarget.id\r\n    // if (!self.data.goods[index].guige) {\r\n    self.data.buy[index].number += 1\r\n    self.data.goods[index].number += 1\r\n    self.setdata({\r\n      buy: self.data.buy,\r\n      goods: self.data.goods,\r\n    })\r\n    self.buy(buy)\r\n    // } \r\n     // var goodsnumber = self.data.goods[index].number\r\n    // var buy = self.data.buy\r\n    // var goodsdata = \"goods[\" + index + \"].number\"\r\n    // for (var i = 0; i < buy.length; i++) {\r\n      //   if (buy[i].id == self.data.goods[index].id) {\r\n      //     buy[i].number++;\r\n      //   }\r\n      // }\r\n  },\r\n  /* 购物车-1 */\r\n  reducenumber(e) {\r\n    var self = this\r\n    var index = e.currentTarget.id\r\n    if(self.data.buy[index].number === 1) {\r\n      self.data.buy.splice(index,1)\r\n    }else{\r\n      self.data.buy[index].number -= 1;\r\n      self.data.goods[index].number -= 1\r\n    }\r\n    // var goodsnumber = self.data.goods[index].number\r\n    // var goodsdata = 'goods[' + index + '].number'\r\n    // var buy = self.data.buy\r\n    // for (var i = 0; i < buy.length; i++) {\r\n    //   if (buy[i].id == self.data.goods[index].id) {\r\n    //     if (buy[i].number == 1) {\r\n    //       buy.splice(i, 1)\r\n    //     } else {\r\n    //       buy[i].number--;\r\n    //       break;\r\n    //     }\r\n    //   }\r\n    // }\r\n   \r\n    // if (goodsnumber > 0) {\r\n    //   self.data.goods[index].number -= 1\r\n    //   self.setdata({\r\n    //     buy: self.data.buy,\r\n    //     // [goodsdata]: goodsnumber - 1,\r\n    //     goods: self.data.goods\r\n    //   })\r\n\r\n    //     self.buy(self.data.buy)\r\n      \r\n\r\n    // }\r\n    self.setdata({\r\n      buy: self.data.buy,\r\n      // [goodsdata]: goodsnumber - 1,\r\n      goods: self.data.goods\r\n    })\r\n\r\n    self.buy(self.data.buy)\r\n    return res\r\n  },\r\n  /* 购物车规格+1 */\r\n  guigeaddgoods(e) {\r\n    var self = this\r\n    var index = e.currentTarget.id\r\n    var goods = self.data.goods\r\n    var buy = self.data.buy\r\n    for (var i = 0; i < goods.length; i++) {\r\n      if (buy[index].id == goods[i].id) {\r\n        var goodsnumber = goods[i].number\r\n        var goodsdata = \"goods[\" + i + \"].number\"\r\n        break;\r\n      }\r\n    }\r\n    buy[index].number++;\r\n    self.setdata({\r\n      buy: buy,\r\n      [goodsdata]: goodsnumber + 1\r\n    })\r\n\r\n      self.buy(buy)\r\n    \r\n  },\r\n  /* 购物车规格-1 */\r\n  guigereducenumber(e) {\r\n    var self = this\r\n    var index = e.currentTarget.dataset.index\r\n    var goods = self.data.goods\r\n    var buy = self.data.buy\r\n    for (var i = 0; i < goods.length; i++) {\r\n      if (buy[index].id == goods[i].id) {\r\n        var goodsnumber = self.data.goods[i].number\r\n        var goodsdata = 'goods[' + i + '].number'\r\n        if (buy[index].number == 1) {\r\n          buy.splice(index, 1)\r\n          break;\r\n        } else {\r\n          buy[index].number--;\r\n          break;\r\n        }\r\n      }\r\n    }\r\n    if (goodsnumber > 0) {\r\n      console.log(buy)\r\n      self.setdata({\r\n        buy: buy,\r\n        [goodsdata]: goodsnumber - 1\r\n      })\r\n\r\n        self.buy(buy)\r\n      \r\n    }\r\n  },\r\n\r\n  buy(buy) {\r\n    // var totalprice = 0\r\n    // var totalnumber = 0\r\n    // for (var i = 0; i < buy.length; i++) {\r\n    //   if(buy[i].zhekou){\r\n    //     totalprice = totalprice + buy[i].number * buy[i].zhekouprice\r\n    //   }else{\r\n    //     totalprice = totalprice + buy[i].number * buy[i].nowprice\r\n    //   }\r\n    //   totalnumber = totalnumber + buy[i].number\r\n    // }\r\n    // 购物车加购的商品数量（numberSum）加一\r\n    var numberSum = buy.reduce((numberSum, item) => {\r\n      return numberSum + item.number;\r\n    },0)\r\n     // 购物车加购的商品价格（priceSum）加一\r\n    var priceSum = buy.reduce((priceSum, item) => {\r\n      return priceSum + item.number * item.nowprice;\r\n      // return priceSum + item.number * (item.nowprice * item.zhekou * 0.1);      //---后期优化，无折扣商品：zhekou=10；有折扣商品：zhekou=zhekou*0.1\r\n    },0)\r\n\r\n    if (numberSum == 0) {\r\n      this.setdata({\r\n        modalName: false\r\n      })\r\n    }\r\n    this.setdata({\r\n      totalprice: priceSum.toFixed(2),\r\n      totalTrue: priceSum.toFixed(2) < this.data.goprice,\r\n      totalyuNumber: this.data.goprice - priceSum.toFixed(2),\r\n      totalnumber: numberSum,\r\n    })\r\n  },\r\n  popUp: function () {          //控制卡片/评论弹窗\r\n    var self=this\r\n    var payStyle = 'payHide';\r\n    // picker动画样式\r\n    if (payStyle == undefined || payStyle == 'payHide') {\r\n      payStyle = 'payShow'\r\n    } else {\r\n      payStyle = 'payHide'\r\n    }\r\n    self.setdata({\r\n       payStyle,\r\n    })\r\n  },\r\n  /* 购物车弹出 */\r\n  showModal() {\r\n    var self = this\r\n    if (self.data.buy.length != 0) {\r\n      self.popUp()\r\n      self.setdata({\r\n        modalName: !this.data.modalName,\r\n        buy: self.data.buy,\r\n      })\r\n    }\r\n  },\r\n  /* 商铺 */\r\n  tabbarshop(e) {\r\n    this.setdata({\r\n      tabbar: true\r\n    })\r\n  },\r\n  /* 个人 */\r\n  tabbaruser(e) {\r\n    this.setdata({\r\n      tabbar: false\r\n    })\r\n  },\r\n  /* 地址设置 */\r\n  userlocation(e) {\r\n    var shop_id=this.data.shop_id\r\n    console.log(shop_id)\r\n    wx.navigateTo({\r\n      url: '../HotTop/HotTop?content=地址&shop_id='+shop_id,\r\n    })\r\n  },\r\n  /* 跳转支付 */\r\n  pay(e) {\r\n    console.log(\"pay\");\r\n    var self = this\r\n    var buy = self.data.buy\r\n    wx.setStorage({\r\n      key: \"pay\",\r\n      data: {\r\n        buy: buy,\r\n        totalnumber: self.data.totalnumber,\r\n        totalprice: self.data.totalprice,\r\n      }\r\n    })\r\n    wx.navigateTo({\r\n\r\n      url: '../HotTop/HotTop?content=支付',\r\n    })\r\n  },\r\n  /* 用户授权 */\r\n  onGetUserInfo: function (e) {\r\n    console.log(e)\r\n    var self = this\r\n    var openid = app.globalData.openid\r\n    if (self.data.newuser && e.detail.userInfo) {\r\n      wx.showLoading({\r\n        mask: 'none',\r\n        title: '用户信息建立中...',\r\n      })\r\n      db.collection('userinfo').add({\r\n        // data 字段表示需新增的 JSON 数据\r\n        data: {\r\n          username: e.detail.userInfo.nickName,\r\n          usertximg: e.detail.userInfo.avatarUrl,\r\n          userlocation: {},\r\n          havelocation: false\r\n        },\r\n        success: function (res) {\r\n          wx.setStorage({\r\n            key: \"userinfo\",\r\n            data: {\r\n              _id: res._id,\r\n              _openid: openid,\r\n              username: e.detail.userInfo.nickName,\r\n              usertximg: e.detail.userInfo.avatarUrl,\r\n              userlocation: {},\r\n              havelocation: false\r\n            }\r\n          })\r\n          self.setdata({\r\n            newuser: false,\r\n            username: e.detail.userInfo.nickName,\r\n            usertximg: e.detail.userInfo.avatarUrl,\r\n            userlocation: {},\r\n            havelocation: false\r\n          })\r\n          console.log(res)\r\n        },\r\n        fail: console.error,\r\n        complete: function (res) {\r\n          wx.hideLoading()\r\n        },\r\n      })\r\n    }\r\n  },\r\n  /* 下拉刷新 */\r\n  onPullDownRefresh: function () {\r\n    if (!this.data.tabbar) {\r\n      wx.showNavigationBarLoading()\r\n      this.onShow()\r\n    } else {\r\n      wx.hideNavigationBarLoading()\r\n      wx.stopPullDownRefresh()\r\n    }\r\n  },\r\n  /* 选规格弹窗开启 */\r\n  xuanguige(e) {\r\n    var self = this\r\n    var index = e.currentTarget.dataset.index\r\n    var goodsname = self.data.goods[index].name\r\n    var goodsguigekouwei = self.data.goods[index].guigekouwei\r\n    var goodsguigekouwei2=self.data.goods[index].guigekouwei2\r\n    self.setdata({\r\n      xuanguigegoodsindex: index,\r\n      goodsname: goodsname,\r\n      goodsguigekouwei: goodsguigekouwei,\r\n      goodsguige2:self.data.goods[index].guige2,\r\n      goodsguigekouwei2:goodsguigekouwei2,\r\n      guige: true\r\n    })\r\n  },\r\n  /* 选规格弹窗隐藏 */\r\n  hidexuanguige(e) {\r\n    var self = this\r\n    self.setdata({\r\n      guige: false\r\n    })\r\n  },\r\n  /* 选规格-口味 */\r\n  guigekouwei(e) {\r\n    this.setdata({\r\n      guigeindex: e.currentTarget.dataset.index\r\n    })\r\n  },\r\n  guigekouwei2(e) {\r\n    this.setdata({\r\n      guigeindex2: e.currentTarget.dataset.index\r\n    })\r\n  },\r\n  /* 选规格加购物车 */\r\n  guigeoneaddgoods(e) {\r\n    console.log(13)\r\n    var self = this\r\n    var index = self.data.xuanguigegoodsindex\r\n    var goodsnumber = self.data.goods[index].number\r\n    var goodsdata = \"good[\" + index + \"].number\"\r\n    var buy = this.data.buy\r\n    if(self.data.goodsguige2){\r\n      var name= self.data.goods[index].name + \"(\" + self.data.goodsguigekouwei[self.data.guigeindex] + \")\"+ \"(\" + self.data.goodsguigekouwei2[self.data.guigeindex2] + \")\"\r\n    }else{\r\n      var name= self.data.goods[index].name + \"(\" + self.data.goodsguigekouwei[self.data.guigeindex] + \")\"\r\n    }\r\n    \r\n    var goods = {\r\n      guige: true,\r\n      id: self.data.goods[index].id,\r\n      img: self.data.goods[index].img,\r\n      name: name,\r\n      price: self.data.goods[index].price,\r\n      zhekou: self.data.goods[index].zhekou,\r\n      zhekouprice: self.data.goods[index].zhekouprice,\r\n      nowprice: self.data.goods[index].nowprice,\r\n      shangpu: self.data.goods[index].shangpu, //所属商铺\r\n      shopid: self.data.goods[index].shopid,\r\n      number: 1, //用户购物车数量\r\n      index: index, //在goods列表里的index\r\n    }\r\n    buy.push(goods)\r\n    self.setdata({\r\n      guige: false,\r\n      buy: buy,\r\n      [goodsdata]: goodsnumber + 1\r\n    }, () => {\r\n      self.buy(buy)\r\n    })\r\n  },\r\n  \r\n\r\n  /**\r\n   * 生命周期函数--监听页面隐藏\r\n   */\r\n  onHide: function () {\r\n    \r\n  },\r\n\r\n  /**\r\n   * 生命周期函数--监听页面卸载\r\n   */\r\n  onUnload: function () {\r\n    \r\n  },\r\n\r\n  /**\r\n   * 页面相关事件处理函数--监听用户下拉动作\r\n   */\r\n  onPullDownRefresh: function () {\r\n    \r\n  },\r\n\r\n  /**\r\n   * 页面上拉触底事件的处理函数\r\n   */\r\n  onReachBottom: function () {\r\n    \r\n  },\r\n\r\n  /**\r\n   * 用户点击右上角分享\r\n   */\r\n  onShareAppMessage: function () {\r\n    \r\n  }\r\n})\n\n\n}\n  window.exports = runCode;\n\n  "],"names":[],"sourceRoot":""}